/*
{
    "user": {
        "uid": "xaj0uNW1hRb6qAH7wsvxNGhHfIA2",
        "email": "alessio.cuccovillo.dev@gmail.com",
        "emailVerified": false,
        "isAnonymous": false,
        "providerData": [
            {
                "providerId": "password",
                "uid": "alessio.cuccovillo.dev@gmail.com",
                "displayName": null,
                "email": "alessio.cuccovillo.dev@gmail.com",
                "phoneNumber": null,
                "photoURL": null
            }
        ],
        "stsTokenManager": {
            "refreshToken": "APZUo0Th-HTs0qCzNmZon2JTTO5TLL55gQCYLGCh7G_bouLOuEvuLaa9m9QKsSoRRiVMGggPfgKfeyxAgqe9b3kAB11qqsyfkmYPdvAz0E-fm-Xy2uAFRpQwxarkzGHUtdmSCSp4OeTc7FunFTMbOWfqdMb6PNUuKh9sNGXri3mjj4czE-fddYGMv-YZTc9aX4hL2WpS_5iM3ZkmDXLOyfuXb-mp7N5SlBrVc_VKY1YyGObF15jTA8g",
            "accessToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImY5N2U3ZWVlY2YwMWM4MDhiZjRhYjkzOTczNDBiZmIyOTgyZTg0NzUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdG9kb2xpdC03MDYzYyIsImF1ZCI6InRvZG9saXQtNzA2M2MiLCJhdXRoX3RpbWUiOjE2ODgzMDIxNDksInVzZXJfaWQiOiJ4YWowdU5XMWhSYjZxQUg3d3N2eE5HaEhmSUEyIiwic3ViIjoieGFqMHVOVzFoUmI2cUFIN3dzdnhOR2hIZklBMiIsImlhdCI6MTY4ODMwMjE0OSwiZXhwIjoxNjg4MzA1NzQ5LCJlbWFpbCI6ImFsZXNzaW8uY3VjY292aWxsby5kZXZAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbImFsZXNzaW8uY3VjY292aWxsby5kZXZAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.RvK6uYOb0G1u8cVTjr-WCpLuytWFHEL0nBa5Rbw9qpOS7PPjK8yWbZKOyaNYGaPmgWZdsFjZK_wLxwFRmbLme_K-Qugx5SYNSP8d_eEG98-HBj_0beIvknfCpZQ89tNAPuzCpRiPAoAg4CPiBROld46ViRLtzK_plhuQ5hH-1ajWEkjBno88Rr1CwjBRGjG5FMXhkdAbhOla875DaSro70LJEQb5j6lVCGGQSScVEksC5BGF3L4ZMsKYISOa1MRHUAG1sYQkMwcitI5aEBY1BnLMKYQVseMOUYYA8A7rjdgxE_ym8CsecgBJWBRQVzvRue8S4e7ButLasQZWi6uUnA",
            "expirationTime": 1688305749537
        },
        "createdAt": "1688302149330",
        "lastLoginAt": "1688302149330",
        "apiKey": "AIzaSyAHyLksTsN_AQdvQ5VRAfQN4zl3sPIKb8g",
        "appName": "[DEFAULT]"
    },
    "providerId": null,
    "_tokenResponse": {
        "kind": "identitytoolkit#SignupNewUserResponse",
        "idToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImY5N2U3ZWVlY2YwMWM4MDhiZjRhYjkzOTczNDBiZmIyOTgyZTg0NzUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdG9kb2xpdC03MDYzYyIsImF1ZCI6InRvZG9saXQtNzA2M2MiLCJhdXRoX3RpbWUiOjE2ODgzMDIxNDksInVzZXJfaWQiOiJ4YWowdU5XMWhSYjZxQUg3d3N2eE5HaEhmSUEyIiwic3ViIjoieGFqMHVOVzFoUmI2cUFIN3dzdnhOR2hIZklBMiIsImlhdCI6MTY4ODMwMjE0OSwiZXhwIjoxNjg4MzA1NzQ5LCJlbWFpbCI6ImFsZXNzaW8uY3VjY292aWxsby5kZXZAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbImFsZXNzaW8uY3VjY292aWxsby5kZXZAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.RvK6uYOb0G1u8cVTjr-WCpLuytWFHEL0nBa5Rbw9qpOS7PPjK8yWbZKOyaNYGaPmgWZdsFjZK_wLxwFRmbLme_K-Qugx5SYNSP8d_eEG98-HBj_0beIvknfCpZQ89tNAPuzCpRiPAoAg4CPiBROld46ViRLtzK_plhuQ5hH-1ajWEkjBno88Rr1CwjBRGjG5FMXhkdAbhOla875DaSro70LJEQb5j6lVCGGQSScVEksC5BGF3L4ZMsKYISOa1MRHUAG1sYQkMwcitI5aEBY1BnLMKYQVseMOUYYA8A7rjdgxE_ym8CsecgBJWBRQVzvRue8S4e7ButLasQZWi6uUnA",
        "email": "alessio.cuccovillo.dev@gmail.com",
        "refreshToken": "APZUo0Th-HTs0qCzNmZon2JTTO5TLL55gQCYLGCh7G_bouLOuEvuLaa9m9QKsSoRRiVMGggPfgKfeyxAgqe9b3kAB11qqsyfkmYPdvAz0E-fm-Xy2uAFRpQwxarkzGHUtdmSCSp4OeTc7FunFTMbOWfqdMb6PNUuKh9sNGXri3mjj4czE-fddYGMv-YZTc9aX4hL2WpS_5iM3ZkmDXLOyfuXb-mp7N5SlBrVc_VKY1YyGObF15jTA8g",
        "expiresIn": "3600",
        "localId": "xaj0uNW1hRb6qAH7wsvxNGhHfIA2"
    },
    "operationType": "signIn"
}
*/
import { initializeApp } from 'firebase/app';
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
} from 'firebase/auth';
import { getDatabase, ref, set, onValue } from 'firebase/database';

export class FirebaseController {
  constructor(host) {
    this.host = host;
    host.addController(this);
    const firebaseConfig = {
      apiKey: 'AIzaSyAHyLksTsN_AQdvQ5VRAfQN4zl3sPIKb8g',
      authDomain: 'todolit-7063c.firebaseapp.com',
      projectId: 'todolit-7063c',
      storageBucket: 'todolit-7063c.appspot.com',
      messagingSenderId: '804872218148',
      appId: '1:804872218148:web:31998bfb028d23ba849ab1',
      databaseURL:
        'https://todolit-7063c-default-rtdb.europe-west1.firebasedatabase.app/',
    };

    this.firebase = initializeApp(firebaseConfig);
    this.auth = getAuth();
    this.db = getDatabase();
  }

  async registerUser(email, password) {
    return new Promise((res, rej) => {
      createUserWithEmailAndPassword(this.auth, email, password)
        .then(data => {
          res(data);
        })
        .catch(err => {
          rej(err);
        });
    });
  }

  async loginUser(email, password) {
    return new Promise((res, rej) => {
      signInWithEmailAndPassword(this.auth, email, password)
        .then(data => {
          res(data);
        })
        .catch(err => {
          rej(err);
        });
    });
  }

  async pushList(userId, list) {
    await set(ref(this.db, `todos/${userId}`), {
      list,
    });
  }

  async readList(userId, callback) {
    const todosRef = ref(this.db, `todos/${userId}`);
    onValue(todosRef, snapshot => {
      callback(snapshot.val());
    });
  }
}
